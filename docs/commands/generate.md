# `sbomqs generate` Command

The `sbomqs generate` command creates configuration files that allow you to customize SBOM scoring criteria. This enables you to tailor quality assessments to your organization's specific requirements.

## Overview

The generate command:
- Creates customizable scoring configuration files
- Allows enabling/disabling specific features
- Supports custom weightings for categories
- Enables organization-specific compliance profiles

## Usage

```bash
sbomqs generate [type] [flags]
```

## Subcommands

- `features`: Generate a features configuration file
- `config`: Generate a complete configuration file (coming soon)

## Flags

- `--output, -o <file>`: Output file path (default: stdout)
- `--format <format>`: Output format (yaml or json, default: yaml)
- `--debug, -D`: Enable debug logging

## Generate Features Configuration

### Basic Usage

```bash
$ sbomqs generate features > my-features.yaml
```

This creates a YAML file with all available scoring features that can be customized.

### Example Output

```yaml
# SBOM Quality Score Features Configuration
# Generated by sbomqs
# 
# Enable/disable features by setting enabled: true/false
# Adjust weights to change feature importance (0.0-1.0)

categories:
  ntia-minimum-elements:
    enabled: true
    weight: 1.0
    features:
      - id: comp_with_names
        enabled: true
        weight: 1.0
        description: "Components have names"
      
      - id: comp_with_versions
        enabled: true
        weight: 1.0
        description: "Components have versions"
      
      - id: comp_with_suppliers
        enabled: true
        weight: 0.8
        description: "Components have supplier information"
      
      - id: sbom_creation_timestamp
        enabled: true
        weight: 0.9
        description: "SBOM has creation timestamp"
      
      - id: sbom_authors
        enabled: true
        weight: 0.7
        description: "SBOM has author information"

  quality:
    enabled: true
    weight: 0.9
    features:
      - id: comp_valid_licenses
        enabled: true
        weight: 1.0
        description: "Components have valid SPDX licenses"
      
      - id: comp_with_checksums
        enabled: true
        weight: 0.8
        description: "Components have checksums"
      
      - id: comp_with_purls
        enabled: true
        weight: 0.9
        description: "Components have package URLs"

  structural:
    enabled: true
    weight: 0.8
    features:
      - id: spec_valid_format
        enabled: true
        weight: 1.0
        description: "SBOM uses valid specification format"
      
      - id: spec_parsable
        enabled: true
        weight: 1.0
        description: "SBOM is parsable"
```

## Customization Examples

### Focus on Security Features

Create a security-focused configuration:

```bash
$ sbomqs generate features > security-focus.yaml
```

Then edit to emphasize security features:

```yaml
categories:
  quality:
    enabled: true
    weight: 1.0
    features:
      - id: comp_with_checksums
        enabled: true
        weight: 1.0  # Maximum weight for integrity
      
      - id: comp_with_cpes
        enabled: true
        weight: 1.0  # Maximum weight for CVE matching
      
      - id: comp_with_purls
        enabled: true
        weight: 1.0  # Maximum weight for vulnerability lookup

  ntia-minimum-elements:
    enabled: true
    weight: 0.7  # Lower weight for non-security features
```

### License Compliance Focus

```yaml
categories:
  quality:
    enabled: true
    weight: 1.0
    features:
      - id: comp_valid_licenses
        enabled: true
        weight: 1.0  # Maximum for license validation
      
      - id: comp_with_licenses
        enabled: true
        weight: 1.0  # Ensure all components have licenses
      
      - id: comp_no_deprecated_licenses
        enabled: true
        weight: 0.9  # Check for deprecated licenses
      
      - id: comp_no_restrictive_licenses
        enabled: true
        weight: 0.8  # Flag restrictive licenses
```

### Minimal NTIA Compliance

```yaml
categories:
  ntia-minimum-elements:
    enabled: true
    weight: 1.0  # Only score NTIA requirements
    
  quality:
    enabled: false  # Disable other categories
    
  structural:
    enabled: false
    
  sharing:
    enabled: false
```

## Using Custom Configurations

### Apply Configuration to Scoring

```bash
# Use custom configuration file
$ sbomqs score my-app.spdx.json --configpath security-focus.yaml

Custom Scoring Profile: security-focus.yaml
SBOM Quality Score: 8.2 my-app.spdx.json
```

### Compare Different Profiles

```bash
#!/bin/bash
# compare-profiles.sh

SBOM="application.spdx.json"

# Generate different profiles
sbomqs generate features > default.yaml
cp default.yaml security.yaml
cp default.yaml compliance.yaml

# Edit profiles (automated or manual)
# ... customize each profile ...

# Score with each profile
echo "Profile Comparison for $SBOM"
echo "================================"

for profile in *.yaml; do
  score=$(sbomqs score "$SBOM" --configpath "$profile" --basic | cut -d' ' -f1)
  echo "$profile: $score/10"
done
```

## Organization-Specific Profiles

### Create Department Standards

```bash
# Engineering team requirements
$ sbomqs generate features > engineering-standards.yaml

# Security team requirements
$ sbomqs generate features > security-standards.yaml

# Compliance team requirements
$ sbomqs generate features > compliance-standards.yaml
```

### Enforce in CI/CD

```yaml
# .github/workflows/sbom-check.yml
- name: Check SBOM Quality
  run: |
    # Download organization standard
    curl -O https://standards.example.com/sbom/engineering-standards.yaml
    
    # Score against organization standard
    score=$(sbomqs score sbom.json --configpath engineering-standards.yaml --json | jq '.files[0].avg_score')
    
    if (( $(echo "$score < 8.0" | bc -l) )); then
      echo "SBOM does not meet engineering standards (score: $score/10)"
      exit 1
    fi
```

## Advanced Configuration

### Feature Dependencies

Some features may depend on others:

```yaml
categories:
  quality:
    features:
      # CPE validation requires version information
      - id: comp_with_versions
        enabled: true
        weight: 1.0
        required_for: [comp_with_cpes]
      
      - id: comp_with_cpes
        enabled: true
        weight: 0.9
        depends_on: [comp_with_versions]
```

### Conditional Scoring

```yaml
# Score differently based on component type
categories:
  quality:
    features:
      - id: comp_with_checksums
        enabled: true
        weight: 1.0
        conditions:
          - type: source_code
            weight: 0.5  # Less important for source
          - type: binary
            weight: 1.0  # Critical for binaries
```

## Profile Templates

### Regulated Industry Template

```bash
#!/bin/bash
# generate-regulated-profile.sh

cat << EOF > regulated-industry.yaml
# Regulated Industry SBOM Requirements
# Emphasizes compliance and traceability

categories:
  ntia-minimum-elements:
    enabled: true
    weight: 1.0
    features:
      - id: comp_with_names
        enabled: true
        weight: 1.0
        required: true  # Must pass
      
      - id: comp_with_versions
        enabled: true
        weight: 1.0
        required: true  # Must pass
      
      - id: comp_with_suppliers
        enabled: true
        weight: 1.0
        required: true  # Must pass
      
      - id: sbom_creation_timestamp
        enabled: true
        weight: 1.0
        required: true  # Must pass
      
      - id: sbom_authors
        enabled: true
        weight: 1.0
        required: true  # Must pass

  quality:
    enabled: true
    weight: 0.9
    features:
      - id: comp_valid_licenses
        enabled: true
        weight: 1.0
        required: true  # Legal requirement
      
      - id: comp_with_checksums
        enabled: true
        weight: 1.0
        required: true  # Integrity requirement
EOF

echo "Generated regulated-industry.yaml"
```

### Open Source Project Template

```yaml
# Open Source SBOM Requirements
# Focuses on transparency and licensing

categories:
  sharing:
    enabled: true
    weight: 1.0
    features:
      - id: sbom_sharable
        enabled: true
        weight: 1.0
      
      - id: open_licenses
        enabled: true
        weight: 1.0

  quality:
    enabled: true
    weight: 0.9
    features:
      - id: comp_valid_licenses
        enabled: true
        weight: 1.0
      
      - id: comp_with_source_urls
        enabled: true
        weight: 0.9
```

## Validation and Testing

### Validate Configuration

```bash
# Check if configuration is valid
$ sbomqs score test.json --configpath my-config.yaml --debug

# Dry run to see what would be scored
$ sbomqs score test.json --configpath my-config.yaml --dry-run
```

### Test Coverage

```bash
#!/bin/bash
# test-config-coverage.sh

CONFIG="my-features.yaml"
SBOM="test.spdx.json"

# Extract enabled features
enabled_features=$(grep -A1 "enabled: true" "$CONFIG" | grep "id:" | cut -d: -f2 | tr -d ' ')

echo "Testing configuration coverage..."
echo "Enabled features:"

for feature in $enabled_features; do
  # Check if feature affects score
  result=$(sbomqs list "$SBOM" --feature "$feature" 2>/dev/null)
  if [ $? -eq 0 ]; then
    echo "✓ $feature - active"
  else
    echo "✗ $feature - not found in SBOM"
  fi
done
```

## Migration and Upgrades

### Migrate Existing Configurations

```bash
# When upgrading sbomqs versions
$ sbomqs generate migrate old-config.yaml > new-config.yaml

# Diff to see changes
$ diff old-config.yaml new-config.yaml
```

### Version Control

```bash
# Track configuration changes
$ git add engineering-standards.yaml
$ git commit -m "Update SBOM quality standards for v2.0 requirements"

# Tag for release
$ git tag -a "sbom-standards-v2.0" -m "SBOM quality standards v2.0"
```

## Best Practices

### Documentation

Always document your custom configurations:

```yaml
# engineering-standards.yaml
# 
# Purpose: Engineering team SBOM quality standards
# Version: 2.0
# Last Updated: 2024-01-15
# Owner: engineering@example.com
# 
# Changes:
# - 2024-01-15: Increased weight for security features
# - 2024-01-10: Added requirement for checksums
# 
# Usage:
# sbomqs score <sbom> --configpath engineering-standards.yaml

categories:
  # ... configuration ...
```

### Standardization

Create organization-wide standards:

```bash
# Central repository for configurations
mkdir sbom-standards
cd sbom-standards

# Department-specific standards
sbomqs generate features > base.yaml
cp base.yaml engineering.yaml
cp base.yaml security.yaml
cp base.yaml compliance.yaml

# Version and distribute
git init
git add .
git commit -m "Initial SBOM quality standards"
```

## Related Commands

- [`score`](./score.md) - Use custom configurations for scoring
- [`compliance`](./compliance.md) - Check against standards
- [`list`](./list.md) - Verify feature presence